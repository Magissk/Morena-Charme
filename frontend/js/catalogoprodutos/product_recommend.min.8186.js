var ProductRecommend=(function(){var extractAlias=function(element){return $(element).attr('name').split('[').pop().slice(0,-1)};var getJson=function(){var ret={Recommend:{}};$('#form-recommend').find('input,textarea').each(function(index,element){if(element.name!='_method'){var alias=extractAlias(element);ret.Recommend[alias]=element.value}});ret.Recommend.recaptcha_response=$('#g-recaptcha-response').val();return JSON.stringify(ret)};var recaptchaReset=function(param=''){$('#g-recaptcha-response-error').remove();var reCaptcha=$('#g-recaptcha-response').val();if(reCaptcha.length>0){grecaptcha.reset()}};var submit=function(){var data=getJson(),self=$(this);if($('#form-recommend').valid()){var reCaptcha=$('#g-recaptcha-response').val();if(reCaptcha.length>0){$('#submit-recommendation').find('.btn-text').addClass('loading-button');$.post(base_url+'produto/recommend/'+$('.product-name').data('id'),{'data':data},function(data){data=JSON.parse(data);if(data.Evento.status){$.message.show('success',{vars:{title:'Produto recomendado com sucesso!',idleTime:3500}});recaptchaReset();close()}else{$.message.show('error',{vars:{title:data.Evento.message},idleTime:3500})}
$('#submit-recommendation').find('.btn-text').removeClass('loading-button')})}else{var error='<label id="g-recaptcha-response-error" class="error" for="g-recaptcha-response">Você precisa completar o Captcha de segurança.</label>';$('.modal-captcha').append(error)}}};var open=function(){$('#modal-tell-me').removeClass().addClass('modal modal-share');var footer_modal='<button id="submit-recommendation" class="btn" type="button">'+'<span class="btn-icon"></span>'+'<span class="btn-text">Enviar</span>'+'</button>';$('.modal-header-title').html('Recomendar este produto <a href="javascript:;" class="modal-close">×</a>');$('.modal-footer').html('');$('.modal-footer').html(footer_modal);$('#modal-product-tellme').hide();$('#modal-rating').hide();$('#modal-recommend').show();$('#div-captcha').show();$.modal.show('fadeInDown','modal-tell-me')};var close=function(){$.modal.hide('fadeInUp','modal-tell-me')};return{open:open,submit:submit}})()